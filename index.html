<!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline';">
Â  Â  <title>Convoking4â„¢ - Organizational Snapshot</title>
Â  Â  <style>
Â  Â  Â  Â  :root {
Â  Â  Â  Â  Â  Â  --brand-primary: #a70200;
Â  Â  Â  Â  Â  Â  --brand-primary-hover: #8c0200;
Â  Â  Â  Â  Â  Â  --brand-secondary: #0056b3;
Â  Â  Â  Â  Â  Â  --border-color: #dee2e6;
Â  Â  Â  Â  Â  Â  --background-light: #f8f9fa;
Â  Â  Â  Â  }

Â  Â  Â  Â  html {
Â  Â  Â  Â  Â  Â  scroll-behavior: smooth;
Â  Â  Â  Â  }

Â  Â  Â  Â  body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f4f7f9; color: #333; margin: 0; padding: 20px; }
Â  Â  Â  Â  .container { max-width: 800px; margin: 20px auto; background: #fff; padding: 30px; border-radius: 10px; box-shadow: 0 6px 15px rgba(0,0,0,0.1); }
Â  Â  Â  Â  .header { text-align: center; border-bottom: 2px solid #eee; padding-bottom: 15px; margin-bottom: 20px;}
Â  Â  Â  Â  .logo-title { font-weight: bold; color: black; font-size: 2.5em; }
Â  Â  Â  Â  .logo-red { color: var(--brand-primary); }
Â  Â  Â  Â  .tagline { font-size: 1.1em; color: #6c757d; margin-top: 5px; font-weight: 500; font-style: italic; }
Â  Â  Â  Â  h1.form-title { color: #333; text-align: center; margin-top: 20px; }
Â  Â  Â  Â  h2 { color: #333; border-bottom: 1px solid var(--border-color); padding-bottom: 10px; margin-top: 40px; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .section-explanation { font-size: 1em; color: #333; margin-bottom: 30px; padding: 15px; background-color: #f7f9fc; border-left: 4px solid var(--brand-secondary); }

Â  Â  Â  Â  fieldset { border: none; padding: 0; margin: 0 0 20px 0; }
Â  Â  Â  Â  .form-group { margin-bottom: 25px; position: relative; }
Â  Â  Â  Â  label.main-label { display: block; font-weight: 600; margin-bottom: 5px; font-size: 1.1em; color: #000; }
Â  Â  Â  Â  .description { font-size: 0.9em; color: #6c757d; margin-top: 0; margin-bottom: 15px; font-style: italic; }
Â  Â  Â  Â  input[type="text"], input[type="number"], select, textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; font-size: 1rem; }
Â  Â  Â  Â  textarea { min-height: 80px; resize: vertical; font-size: 0.95rem; }
Â  Â  Â  Â  .input-group-container { margin-bottom: 15px; }
Â  Â  Â  Â  .input-group { display: flex; align-items: center; }
Â  Â  Â  Â  .input-group input[type="radio"], .input-group input[type="checkbox"] { margin-right: 10px; transform: scale(1.1); }
Â  Â  Â  Â  .input-group label { font-weight: normal; }
Â  Â  Â  Â  .option-description, .option-example { font-size: 0.85em; margin-top: 2px; margin-left: 28px; line-height: 1.4; }
Â  Â  Â  Â  .option-description { color: #6c757d; }
Â  Â  Â  Â  .option-example { color: #5a6268; font-style: italic; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .conditional-field { display: none; }
Â  Â  Â  Â  .conditional-field.visible { display: block; }

Â  Â  Â  Â  .rank-choice-group .input-group { justify-content: space-between; }
Â  Â  Â  Â  .rank-choice-group .rank-input { width: 50px; text-align: center; margin-right: 15px; }
Â  Â  Â  Â  .rank-choice-group .rank-label { flex-grow: 1; }

Â  Â  Â  Â  .top-bar { position: sticky; top: 0; background-color: rgba(255, 255, 255, 0.98); backdrop-filter: blur(5px); padding: 15px; margin: 0 -30px 20px -30px; border-bottom: 1px solid var(--border-color); z-index: 100; }
Â  Â  Â  Â  .top-bar-controls { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; }
Â  Â  Â  Â  .top-bar-info { display: flex; align-items: center; gap: 15px; }
Â  Â  Â  Â  .top-bar-info .info-label { font-weight: 600; font-size: 0.9em; }
Â  Â  Â  Â  .top-bar-info span { font-size: 0.9em; color: #6c757d; }
Â  Â  Â  Â  .top-bar-actions .button-label { font-size: 0.9em; padding: 8px 12px; background-color: #f0f0f0; color: #333; border: 1px solid #ccc; cursor: pointer; border-radius: 5px; transition: all 0.2s ease; display: inline-block; }
Â  Â  Â  Â  .top-bar-actions .button-label:hover { background-color: #e0e0e0; border-color: #bbb; }
Â  Â  Â  Â  .nav-links { display: flex; flex-wrap: wrap; gap: 15px; list-style: none; padding: 15px 0 0 0; margin: 0; }
Â  Â  Â  Â  .nav-links a { text-decoration: none; color: var(--brand-primary); font-weight: 600; font-size: 0.9em; cursor: pointer; }
Â  Â  Â  Â  .nav-links a:hover { text-decoration: underline; }
Â  Â  Â  Â  .nav-highlight { font-weight: bold; }

Â  Â  Â  Â  #notification-banner { position: fixed; top: -100px; left: 50%; transform: translateX(-50%); background-color: #28a745; color: white; padding: 15px 30px; border-radius: 5px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); z-index: 200; transition: top 0.5s ease-in-out; }
Â  Â  Â  Â  #notification-banner.is-visible { top: 20px; }
Â  Â  Â  Â  #notification-banner.is-error { background-color: var(--brand-primary); }
Â  Â  Â  Â  #notification-banner.is-info { background-color: var(--brand-secondary); cursor: pointer; }

Â  Â  Â  Â  .btn { display: block; width: 100%; background-color: var(--brand-primary); color: #fff; padding: 15px; font-size: 1.2em; font-weight: 700; border-radius: 5px; border: none; cursor: pointer; transition: background-color 0.3s ease; margin-top: 30px; }
Â  Â  Â  Â  .btn:hover { background-color: var(--brand-primary-hover); }
Â  Â  Â  Â  .btn.is-dirty { background-color: var(--brand-secondary); }

Â  Â  Â  Â  .subsection-container { margin-top: 15px; padding: 20px; border: 1px solid var(--border-color); border-radius: 8px; background-color: var(--background-light); }
Â  Â  Â  Â  .subsection-title { font-weight: 600; font-size: 1rem; display: block; margin-bottom: 10px; }

Â  Â  Â  Â  .goals-summary-item { margin-bottom: 20px; padding: 15px; border: 1px solid #eee; border-radius: 5px; background-color: #f8f9fa; }
Â  Â  Â  Â  .goals-summary-item strong { display: block; font-size: 1.1em; color: #000; margin-bottom: 8px; }
Â  Â  Â  Â  .goals-summary-item .summary-label { font-weight: bold; color: #555; font-size: 0.9em; margin-top: 10px; display: block; }
Â  Â  Â  Â  .goals-summary-item pre { white-space: pre-wrap; font-family: inherit; font-size: 0.95em; margin: 5px 0 0 0; }

Â  Â  Â  Â  .journey-step { margin-top: 50px; padding: 25px; border: 2px dashed var(--brand-secondary); border-radius: 8px; background-color: #f7f9fc; text-align: center; }
Â  Â  Â  Â  .journey-step h2 { border: none; margin-top: 0; font-size: 1.5em; color: var(--brand-secondary); }
Â  Â  Â  Â  .journey-step p { margin-bottom: 20px; }
Â  Â  Â  Â  #consult-ai-button { background-color: var(--brand-secondary); color: white; padding: 12px 25px; font-size: 1.1em; font-weight: 600; border-radius: 5px; border: none; cursor: pointer; transition: background-color 0.3s; }
Â  Â  Â  Â  #consult-ai-button:hover { background-color: #004494; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  #ai-prompt-modal { border: 1px solid #ccc; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); padding: 0; max-width: 750px; width: 90%; }
Â  Â  Â  Â  #ai-prompt-modal::backdrop { background: rgba(0, 0, 0, 0.5); }
Â  Â  Â  Â  .modal-header { display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; border-bottom: 1px solid var(--border-color); }
Â  Â  Â  Â  .modal-header h3 { margin: 0; font-size: 1.3em; }
Â  Â  Â  Â  .modal-header .close-button { background: none; border: none; font-size: 1.8em; cursor: pointer; color: #888; }
Â  Â  Â  Â  .modal-content { padding: 20px; }
Â  Â  Â  Â  .modal-content ol { padding-left: 20px; font-size: 0.95em; }
Â  Â  Â  Â  .modal-content li { margin-bottom: 10px; }
Â  Â  Â  Â  #ai-prompt-output { width: 100%; height: 300px; resize: vertical; font-family: monospace; font-size: 0.85em; background-color: var(--background-light); }
Â  Â  Â  Â  .modal-footer { display: flex; justify-content: flex-end; gap: 10px; padding: 15px 20px; border-top: 1px solid var(--border-color); background-color: #f8f9fa; }
Â  Â  Â  Â  .modal-footer button { padding: 10px 15px; border: 1px solid #ccc; border-radius: 5px; cursor: pointer; font-weight: 600; }
Â  Â  Â  Â  .modal-footer .btn-secondary { background-color: #6c757d; color: white; }
Â  Â  Â  Â  .modal-footer .btn-primary { background-color: var(--brand-secondary); color: white; }
Â  Â  </style>
</head>
<body>
Â  Â  <div class="container">
Â  Â  Â  Â  <div class="top-bar">
Â  Â  Â  Â  Â  Â  Â <div class="top-bar-controls">
Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="top-bar-info">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="info-label">Date:</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span id="current-date"></span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="info-label" id="version-display"></span>
Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="top-bar-actions">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <label for="progress-file-loader" class="button-label">Load Profile from File</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â <ul class="nav-links" id="nav-links-container">
Â  Â  Â  Â  Â  Â  Â </ul>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="header">
Â  Â  Â  Â  Â  Â  <h1 class="logo-title">Convoking<span class="logo-red">4</span>â„¢</h1>
Â  Â  Â  Â  Â  Â  <p class="tagline">Understand. Align. Decide. Thrive.</p>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <main>
Â  Â  Â  Â  Â  Â  <h1 class="form-title">Organizational Snapshot Assessment</h1>
Â  Â  Â  Â  Â  Â  <p class="description" style="text-align: center; max-width: 600px; margin: auto; margin-bottom: 20px;">This assessment gives a quick, clear picture of an organization's identity, operations, and strategic setup at a certain time. It helps stakeholders and AI assistants understand the organization's purpose, structure, and activities for planning, comparing, communicating, or making decisions.</p>

Â  Â  Â  Â  Â  Â  <form id="profile-form">
Â  Â  Â  Â  Â  Â  Â  Â  <div id="dynamic-form-content"></div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div id="questionnaire-and-validation-container">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <p class="description" style="text-align: center; font-size: 0.8em; margin-top: 20px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Note: Your progress is automatically saved in your browser's local storage for your convenience. This data is not sent anywhere.
Â  Â  Â  Â  Â  Â  Â  Â  </p>

Â  Â  Â  Â  Â  Â  Â  Â  <button id="generate-button" class="btn">Save Profile to File (.json)</button>
Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  </main>
Â  Â  </div>
Â  Â Â 
Â  Â  <div id="notification-banner"></div>
Â  Â  <input type="file" id="progress-file-loader" style="display:none" accept=".json">

Â  Â  <dialog id="ai-prompt-modal">
Â  Â  Â  Â  <header class="modal-header">
Â  Â  Â  Â  Â  Â  <h3>The Advanced AI Prompt for Strategic Audits</h3>
Â  Â  Â  Â  Â  Â  <button class="close-button" aria-label="Close" id="close-modal-button-top">&times;</button>
Â  Â  Â  Â  </header>
Â  Â  Â  Â  <section class="modal-content">
Â  Â  Â  Â  Â  Â  <p><strong>Instructions:</strong> Copy and paste the entire prompt below into your AI assistant to validate your assessment.</p>
Â  Â  Â  Â  Â  Â  <ol>
Â  Â  Â  Â  Â  Â  Â  Â  <li>Click the "Select All & Copy" button to copy the prompt to your clipboard.</li>
Â  Â  Â  Â  Â  Â  Â  Â  <li>Go to your preferred AI assistant (e.g., Google's Gemini).</li>
Â  Â  Â  Â  Â  Â  Â  Â  <li>Paste the complete text and submit it for analysis.</li>
Â  Â  Â  Â  Â  Â  </ol>
Â  Â  Â  Â  Â  Â  <textarea id="ai-prompt-output" readonly></textarea>
Â  Â  Â  Â  </section>
Â  Â  Â  Â  <footer class="modal-footer">
Â  Â  Â  Â  Â  Â  <button id="select-prompt-button" class="btn-primary">Select All & Copy</button>
Â  Â  Â  Â  Â  Â  <button id="close-modal-button-bottom" class="btn-secondary">Close</button>
Â  Â  Â  Â  </footer>
Â  Â  </dialog>

Â  Â  <script>
Â  Â  // Convoking4 Organizational Snapshot Assessment
Â  Â  // Version: 6.15
Â  Â  // Date: August 19, 2025

Â  Â  (function() {
Â  Â  Â  Â  const APP_VERSION = '6.15';
Â  Â  Â  Â  const form = document.getElementById('profile-form');
Â  Â  Â  Â  const formContainer = document.getElementById('dynamic-form-content');
Â  Â  Â  Â  const navLinksContainer = document.getElementById('nav-links-container');
Â  Â  Â  Â  const finalContainer = document.getElementById('questionnaire-and-validation-container');
Â  Â  Â  Â  const saveButton = document.getElementById('generate-button');
Â  Â  Â  Â  const topBar = document.querySelector('.top-bar');
Â  Â  Â  Â  let scrollMarginStyleElement = null;
Â  Â  Â  Â  let isDirty = false;
Â  Â  Â  Â  let isRepopulating = false;

Â  Â  Â  Â  const createTextField = (id, title, description, rows = 3, path, example = '') => {
Â  Â  Â  Â  Â  Â  return `<div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="${id}" class="main-label">${title}</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${description ? `<p class="description">${description}</p>` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${example ? `<p class="option-example">${example}</p>` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="${id}" rows="${rows}" data-path="${path}"></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  Â  };

Â  Â  Â  Â  const createInputField = (id, title, description, path, example = '', type = 'text', attributes = {}) => {
Â  Â  Â  Â  Â  Â  const attrString = Object.entries(attributes).map(([key, value]) => `${key}="${value}"`).join(' ');
Â  Â  Â  Â  Â  Â  return `<div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="${id}" class="main-label">${title}</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${description ? `<p class="description">${description}</p>` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${example ? `<p class="option-example">${example}</p>` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="${type}" id="${id}" data-path="${path}" ${attrString}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  Â  };

Â  Â  Â  Â  const createMultiChoice = (id, title, description, type, options, path, isSubsection = false) => {
Â  Â  Â  Â  Â  Â  let optionsHTML = options.map(opt => {
Â  Â  Â  Â  Â  Â  Â  Â  const uniqueId = `${id}-${opt.label.toLowerCase().replace(/[^a-z0-9]/g, '')}`;
Â  Â  Â  Â  Â  Â  Â  Â  const optDescription = opt.description ? `<p class="option-description">${opt.description}</p>` : '';
Â  Â  Â  Â  Â  Â  Â  Â  const optExample = opt.example ? `<p class="option-example">${opt.example}</p>` : '';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const showFor = opt.showFor ? `data-show-for="${opt.showFor.join(',')}"` : '';
Â  Â  Â  Â  Â  Â  Â  Â  const containerClass = opt.showFor ? 'conditional-field' : '';

Â  Â  Â  Â  Â  Â  Â  Â  return `<div class="input-group-container ${containerClass}" ${showFor}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="${type}" id="${uniqueId}" name="${id}" value="${opt.label}" data-path="${path}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="${uniqueId}">${opt.label}</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${optDescription}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${optExample}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  Â  Â  Â  }).join('');

Â  Â  Â  Â  Â  Â  const labelClass = isSubsection ? 'subsection-title' : 'main-label';
Â  Â  Â  Â  Â  Â  const labelElement = title ? `<label class="${labelClass}">${title}</label>` : '';

Â  Â  Â  Â  Â  Â  return `<div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${labelElement}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${description && !isSubsection ? `<p class="description">${description}</p>` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="${type}-group">${optionsHTML}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  const createRankedChoice = (id, title, description, options, path) => {
Â  Â  Â  Â  Â  Â  let optionsHTML = options.map(opt => {
Â  Â  Â  Â  Â  Â  Â  Â  const uniqueId = `${id}-${opt.label.toLowerCase().replace(/[^a-z0-9]/g, '')}`;
Â  Â  Â  Â  Â  Â  Â  Â  return `<div class="input-group-container">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" class="rank-input" min="1" max="${options.length}" data-rank-value="${opt.label}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="${uniqueId}" class="rank-label">${opt.label}</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  Â  Â  Â  }).join('');

Â  Â  Â  Â  Â  Â  return `<div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="main-label">${title}</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${description ? `<p class="description">${description}</p>` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="rank-choice-group" data-rank-path="${path}">${optionsHTML}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  Â  };

Â  Â  Â  Â  const createSelectField = (id, title, description, path, options) => {
Â  Â  Â  Â  Â  Â  let optionsHTML = options.map(opt => `<option value="${opt.value}">${opt.label}</option>`).join('');
Â  Â  Â  Â  Â  Â  return `<div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="${id}" class="main-label">${title}</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${description ? `<p class="description">${description}</p>` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="${id}" data-path="${path}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${optionsHTML}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  const sections = [
Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  title: "Section 1: Basic Information", id: "section-identifiers", path: "basicIdentifiers",
Â  Â  Â  Â  Â  Â  Â  Â  description: "Start with the basics. This helps identify the organization and its context.",
Â  Â  Â  Â  Â  Â  Â  Â  changesPrompt: "Any recent changes to your organization's name, location, or founding team?",
Â  Â  Â  Â  Â  Â  Â  Â  goalsPrompt: "What is your primary goal related to your basic identity? (e.g., formalize incorporation, establish a new HQ)",
Â  Â  Â  Â  Â  Â  Â  Â  parts: [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createInputField("org-name", "1.1 Organization Name", "", "basicIdentifiers.organizationName", "Example: HealthyCare Clinic", "text", {required: true}),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createInputField("org-year", "1.2 Year Founded", "", "basicIdentifiers.yearFormed", "Example: 2015", "number", {min: "1800", max: new Date().getFullYear()}),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createInputField("org-city", "1.3 Primary City", "", "basicIdentifiers.city", "Example: Raleigh"),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createInputField("org-country", "1.4 Primary Country", "", "basicIdentifiers.country", "Example: United States"),
Â  Â  Â  Â  Â  Â  Â  Â  ]
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  title: "Section 2: Organization Identity", id: "section-identity", path: "identity", isCritical: true,
Â  Â  Â  Â  Â  Â  Â  Â  description: "Define the core of your organization. Your answers here set the context for the entire analysis.",
Â  Â  Â  Â  Â  Â  Â  Â  changesPrompt: "Have there been any recent shifts in your legal structure, funding model, or target scale?",
Â  Â  Â  Â  Â  Â  Â  Â  goalsPrompt: "What is your top goal related to your identity? (e.g., Secure Series A funding, transition to a non-profit)",
Â  Â  Â  Â  Â  Â  Â  Â  parts: [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createMultiChoice("org-archetype", "2.1 Primary Organizational Archetype", "What is the fundamental purpose of your organization? Select one.", "radio", [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {label: "For-Profit Business", description: "Primary focus is generating profit for owners or shareholders."},
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {label: "Mission-Driven Organization", description: "Primary focus is a social or public good, with profit being secondary (e.g., non-profit, NGO)."},
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {label: "Member/Community-Based Organization", description: "Primary focus is serving a specific group of members (e.g., club, association, HOA)."},
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {label: "Investor/Financial Firm", description: "Primary focus is investing capital to generate financial returns."},
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {label: "Hybrid Organization", description: "Blends profit-generation with a core social or community mission (e.g., B-Corp)."},
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {label: "Uncertain", description: "The organization's purpose is not clearly defined."}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ], "identity.archetype"),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createMultiChoice("funding-model", "2.2 Primary Funding Model", "How does your organization primarily finance its operations?", "radio", [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {label: "Revenue from Services/Products", showFor: ["For-Profit Business", "Hybrid Organization"]},
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {label: "Donations/Grants", showFor: ["Mission-Driven Organization", "Hybrid Organization"]},
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {label: "Membership Fees", showFor: ["Member/Community-Based Organization"]},
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {label: "Assessments (e.g., HOA dues)", showFor: ["Member/Community-Based Organization"]},
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {label: "Investment Returns", showFor: ["Investor/Financial Firm"]},
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {label: "Bootstrapping", showFor: ["For-Profit Business"]},
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {label: "Institutional Support", showFor: ["Mission-Driven Organization", "Member/Community-Based Organization"]},
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {label: "Mixed Funding", showFor: ["For-Profit Business", "Hybrid Organization", "Mission-Driven Organization"]},
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {label: "Uncertain"}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ], "identity.fundingModel"),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createMultiChoice("legal-structure", "2.3 Legal Structure", "What is your organization's legal form?", "radio", [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {label: "LLC (Limited Liability Company)", showFor: ["For-Profit Business", "Hybrid Organization"]},
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {label: "Corporation (C-Corp/S-Corp)", showFor: ["For-Profit Business", "Hybrid Organization", "Investor/Financial Firm"]},
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {label: "Nonprofit/NGO", showFor: ["Mission-Driven Organization"]},
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {label: "Sole Proprietorship", showFor: ["For-Profit Business"]},
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {label: "Partnership", showFor: ["For-Profit Business", "Investor/Financial Firm"]},
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {label: "B-Corp/Hybrid", showFor: ["Hybrid Organization"]},
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {label: "Cooperative", showFor: ["Member/Community-Based Organization", "Hybrid Organization"]},
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {label: "Homeownersâ€™ Association (HOA)", showFor: ["Member/Community-Based Organization"]},
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {label: "Student Organization", showFor: ["Member/Community-Based Organization"]},
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {label: "Pre-Formal/Informal"},
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {label: "Uncertain"}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ], "identity.legalStructure"),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `<div class="subsection-container conditional-field" data-show-for="For-Profit Business,Hybrid Organization,Investor/Financial Firm">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="main-label">Financial Health Snapshot (Optional for For-Profit businesses)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${createInputField("burn-rate", "Monthly Burn Rate (USD)", "", "identity.financials.monthlyBurnRate", "", "number", {placeholder: "e.g., 50000"})}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${createInputField("runway", "Cash Runway (Months)", "", "identity.financials.cashRunwayMonths", "", "number", {placeholder: "e.g., 18"})}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${createInputField("margin", "Gross Margin (%)", "", "identity.financials.grossMargin", "", "number", {placeholder: "e.g., 75"})}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${createInputField("cac", "Customer Acquisition Cost (CAC, USD)", "", "identity.financials.customerAcquisitionCost", "", "number", {placeholder: "e.g., 500"})}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>`,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createMultiChoice("org-size", "2.4 Organization Size (People)", "Based on employees, members, or active participants.", "radio", [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {label: "Micro (<10)"}, {label: "Small (10â€“50)"}, {label: "Medium (51â€“200)"}, {label: "Large (>200)"}, {label: "Uncertain"}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ], "identity.size"),
Â  Â  Â  Â  Â  Â  Â  Â  ]
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  title: "Section 3: Core Strategy", id: "section-foundation", path: "strategicFoundation", isCritical: true,
Â  Â  Â  Â  Â  Â  Â  Â  description: "Define your organization's strategic direction. This is the compass that guides your decisions.",
Â  Â  Â  Â  Â  Â  Â  Â  changesPrompt: "Have there been any recent pivots or refinements to your mission, vision, or core values?",
Â  Â  Â  Â  Â  Â  Â  Â  goalsPrompt: "What is your primary goal for your strategy itself? (e.g., achieve mission-alignment in all departments)",
Â  Â  Â  Â  Â  Â  Â  Â  parts: [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createTextField("mission", "3.1 Mission Statement", "Your 'Why'. What is your organization's core purpose?", 2, "strategicFoundation.mission", "Example: To deliver accessible, tech-enabled healthcare to our community."),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createTextField("vision", "3.2 Vision Statement", "Your 'Where'. What is the future you aim to create?", 2, "strategicFoundation.vision", "Example: To be the leading digital credit union in our region."),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createTextField("values", "3.3 Core Values", "Your 'How'. List up to 5 principles that guide your behavior.", 3, "strategicFoundation.values", "Example: Innovation, Efficiency, Sustainability, Collaboration, Quality."),
Â  Â  Â  Â  Â  Â  Â  Â  ]
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  title: "Section 4: Customer & Market", id: "section-customer", path: "customerAndMarket", isCritical: true,
Â  Â  Â  Â  Â  Â  Â  Â  description: "Define who you serve and the environment you operate in. Understanding your market is key to strategic success.",
Â  Â  Â  Â  Â  Â  Â  Â  changesPrompt: "Any recent shifts in customer feedback, ideal customer profile, or competitor actions?",
Â  Â  Â  Â  Â  Â  Â  Â  goalsPrompt: "What is your #1 customer or market-related goal for the next year? (e.g., increase customer retention from 80% to 90%)",
Â  Â  Â  Â  Â  Â  Â  Â  parts: [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createTextField("icp", "4.1 Ideal Customer Profile", "Describe your primary customer. Who are they and what do they need?", 4, "customerAndMarket.icp", "Example: Adults aged 25â€“55 in Raleigh, seeking user-friendly digital banking, frustrated by slow traditional services."),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createTextField("job-to-be-done", "4.2 Customer's Problem", "In one sentence, what problem does your customer 'hire' you to solve?", 2, "customerAndMarket.jobToBeDone", "Example: Help me manage my finances easily and securely from my phone so I can save time."),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createTextField("uvp", "4.3 Unique Value Proposition", "What makes your organization unique and why should customers choose you?", 2, "customerAndMarket.uvp", "Example: We offer affordable, seamless telehealth with same-day appointments."),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `<div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="main-label">4.4 Competitive Landscape</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="description">Describe your market structure and key competitors.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="subsection-container">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${createMultiChoice('market-dynamics', 'a. Market Dynamics', '', 'radio', [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {label: "Dominant Leader"}, {label: "Oligopoly (A few major players)"}, {label: "Fragmented (Many small players)"}, {label: "Emerging (New market)"}, {label: "Uncertain"}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ], "customerAndMarket.competitiveLandscape.marketDynamics", true)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="subsection-container">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${createTextField('key-competitors', 'b. Key Competitors', 'List your top 1-3 competitors. For each, what is the primary reason a customer would choose them over you?', 4, "customerAndMarket.competitiveLandscape.keyCompetitors", "Example: BigBank (Reason: Customers trust their established brand and feel their money is safer).")}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>`
Â  Â  Â  Â  Â  Â  Â  Â  ]
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  title: "Section 5: Operations & Culture", id: "section-operations", path: "operationsAndCulture", isCritical: true,
Â  Â  Â  Â  Â  Â  Â  Â  description: "Evaluate your internal workingsâ€”what you offer, how you decide, and how you manage risk.",
Â  Â  Â  Â  Â  Â  Â  Â  changesPrompt: "Any recent operational changes like new tools, team restructuring, or shifts in decision-making?",
Â  Â  Â  Â  Â  Â  Â  Â  goalsPrompt: "What is your top internal operational priority for the next year? (e.g., reduce product development cycle time by 20%)",
Â  Â  Â  Â  Â  Â  Â  Â  parts: [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createMultiChoice("primary-offering", "5.1 Primary Offering", "What is the main product or service you provide?", "radio", [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {label: "Physical Product"}, {label: "Digital Product"}, {label: "Service"}, {label: "Platform/Marketplace"}, {label: "Hybrid (Product & Service)"}, {label: "Uncertain"}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ], "operationsAndCulture.primaryOffering"),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createMultiChoice("decision-style", "5.2 Decision-Making Style", "How are major decisions typically made in your organization?", "radio", [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {label: "Top-Down (by leadership)"}, {label: "Consensus-Based (group agreement)"}, {label: "Data-Driven (based on analytics)"}, {label: "Individual Autonomy (by experts)"}, {label: "Hybrid"}, {label: "Uncertain"}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ], "operationsAndCulture.decisionStyle"),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createSelectField("risk-appetite", "5.3 Risk Appetite", "How would you rate your organization's willingness to take risks to achieve its goals?", "operationsAndCulture.riskAppetite", [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {value: "", label: "Select a rating..."},
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {value: "3", label: "3 - Averse (We prioritize stability and avoid uncertain outcomes.)"},
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {value: "5", label: "5 - Calculated (We take risks with a clear potential return.)"},
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {value: "7", label: "7 - Seeking (We pursue high-growth opportunities, accepting uncertainty.)"},
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {value: "10", label: "10 - Aggressive (We believe playing it safe is the biggest risk.)"},
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ]),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createTextField('risk-story', "5.4 Example of a Recent Risk", "Briefly describe a recent risk your organization took and what the outcome was.", 3, "operationsAndCulture.riskStory", "Example: We launched a new product line based on early market data. It exceeded sales forecasts by 50% in the first quarter."),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createTextField('team-strengths-gaps', "5.5 Team Strengths & Gaps", "What is your team's single greatest strength, and what is the most critical skill or role gap you currently have?", 3, "operationsAndCulture.teamCapabilities", "Example: Strength: World-class engineering. Gap: We lack an experienced Head of Marketing."),
Â  Â  Â  Â  Â  Â  Â  Â  ]
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  title: "Section 6: Past Performance & Lessons", id: "section-history", path: "strategicHistory",
Â  Â  Â  Â  Â  Â  Â  Â  description: "Reflect on past events to inform future strategy. Your history contains your most valuable lessons.",
Â  Â  Â  Â  Â  Â  Â  Â  changesPrompt: "What is the most significant event (positive or negative) from the past year?",
Â  Â  Â  Â  Â  Â  Â  Â  goalsPrompt: "What is your primary goal related to learning from the past? (e.g., implement a formal post-mortem process)",
Â  Â  Â  Â  Â  Â  Â  Â  parts: [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createTextField("past-failures", "6.1 Analyze a Past Failure", "Describe a significant past failure or setback. What was the primary lesson learned?", 4, "strategicHistory.pastFailures", "Example: Our first telehealth app launch failed due to poor user onboarding. Lesson: Involve real users in testing from day one."),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createMultiChoice("failure-pattern", "Was this an isolated event or part of a recurring pattern?", "", "radio", [{label: "Isolated Event"}, {label: "Recurring Pattern"}], "strategicHistory.pastFailuresPattern"),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createTextField("past-successes", "6.2 Analyze a Past Success", "Describe a significant past success. What was the key factor that made it successful?", 4, "strategicHistory.pastSuccesses", "Example: Partnering with local businesses boosted our user adoption by 300%. Factor: Strategic alliances provided credibility and access to new customers."),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createMultiChoice("success-pattern", "Was this an isolated event or part of a recurring pattern?", "", "radio", [{label: "Isolated Event"}, {label: "Recurring Pattern"}], "strategicHistory.pastSuccessesPattern"),
Â  Â  Â  Â  Â  Â  Â  Â  ]
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  title: "Section 7: Market Environment", id: "section-ecosystem", path: "ecosystem", isCritical: true,
Â  Â  Â  Â  Â  Â  Â  Â  description: "Evaluate the external forces that impact your organization. No strategy exists in a vacuum.",
Â  Â  Â  Â  Â  Â  Â  Â  changesPrompt: "Have any new dependencies, trends, or risks emerged recently?",
Â  Â  Â  Â  Â  Â  Â  Â  goalsPrompt: "What is your top goal for positioning your organization in the market? (e.g., become a thought leader on a key trend)",
Â  Â  Â  Â  Â  Â  Â  Â  parts: [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createMultiChoice("key-dependencies", "7.1 Key External Dependencies", "Select all external factors your organization relies on to function.", "checkbox", [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {label: "Key Suppliers/Vendors"}, {label: "Technology Platforms"}, {label: "Regulatory Approval"}, {label: "Community/User Engagement"}, {label: "Strategic Partners"}, {label: "Access to Capital"}, {label: "Uncertain"}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ], "ecosystem.keyDependencies"),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createRankedChoice("external-forces", "7.2 External Trends", "Rank the following trends from most (1) to least impactful on your organization.", [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {label: "Competitive & Partner Dynamics"}, {label: "Shifting Customer Behavior"}, {label: "Technological Disruption"}, {label: "Regulatory & Geopolitical Instability"}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ], "ecosystem.externalForcesRanked"),
Â  Â  Â  Â  Â  Â  Â  Â  ]
Â  Â  Â   D,
Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  title: "Section 8: Market Position", id: "section-market-pos", path: "marketPosition",
Â  Â  Â  Â  Â  Â  Â  Â  description: "Define your organizationâ€™s role and self-perception in the 'story' of your industry.",
Â  Â  Â  Â  Â  Â  Â  Â  changesPrompt: "Has your perception of your market role changed recently?",
Â  Â  Â  Â  Â  Â  Â  Â  goalsPrompt: "What is your goal for your market position? (e.g., move from a Niche Player to a Challenger)",
Â  Â  Â  Â  Â  Â  Â  Â  parts: [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createMultiChoice("market-position", "8.1 Market Role", "Which option best describes your organization's current role in the market?", "radio", [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {label: "Leader/Incumbent"}, {label: "Challenger"}, {label: "Niche Player"}, {label: "New Entrant/Disruptor"}, {label: "Uncertain"}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ], "marketPosition.marketPosition")
Â  Â  Â  Â  Â  Â  Â  Â  ]
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  title: "Section 9: Stakeholder Perspectives (Optional)", id: "section-stakeholders", path: "stakeholders",
Â  Â  Â  Â  Â  Â  Â  Â  description: "Strategy is shaped by people. Briefly capture the viewpoints of 1-3 key stakeholders to reveal internal alignment or conflict.",
Â  Â  Â  Â  Â  Â  Â  Â  changesPrompt: "Has there been a recent change in key stakeholders (e.g., new board member, key executive departure)?",
Â  Â  Â  Â  Â  Â  Â  Â  goalsPrompt: "What is your primary goal regarding stakeholder alignment? (e.g., get the entire leadership team to agree on the Q4 roadmap)",
Â  Â  Â  Â  Â  Â  Â  Â  parts: [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createTextField("stakeholder-perspectives", "List Key Stakeholders", "For each stakeholder, provide their role, primary concern, and a key quote.", 10, "stakeholders.perspectives", `Example:
Role: CTO
Concern: Technical debt and scalability
Quote: "We're building a monolith that will be hard to pivot."

Role: Head of Sales
Concern: Hitting quarterly revenue targets
Quote: "I don't care if it's perfect, I need new features to sell now."`)
Â  Â  Â  Â  Â  Â  Â  Â  ]
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  ];

Â  Â  Â  Â  // --- DYNAMICALLY BUILD THE FORM AND NAV ---
Â  Â  Â  Â  const formHtml = [];
Â  Â  Â  Â  const navHtml = [];
Â  Â  Â  Â  sections.forEach(section => {
Â  Â  Â  Â  Â  Â  const criticalIcon = section.isCritical ? 'ðŸ§  ' : '';
Â  Â  Â  Â  Â  Â  let sectionDescription = section.description;
Â  Â  Â  Â  Â  Â  if (section.isCritical && sectionDescription) {
Â  Â  Â  Â  Â  Â  Â  Â  sectionDescription = `<strong>Note: This section is fundamental for an accurate AI-driven strategic analysis.</strong> ` + sectionDescription;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  formHtml.push(`<h2 id="${section.id}">${criticalIcon}${section.title}</h2>`);
Â  Â  Â  Â  Â  Â  if (sectionDescription) { formHtml.push(`<p class="section-explanation">${sectionDescription}</p>`); }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  formHtml.push(`<fieldset>`);
Â  Â  Â  Â  Â  Â  formHtml.push(section.parts.join(''));

Â  Â  Â  Â  Â  Â  const changesPrompt = section.changesPrompt || "What has recently changed in this area?";
Â  Â  Â  Â  Â  Â  const goalsPrompt = section.goalsPrompt || "What is your primary goal for this area in the next 12 months?";
Â  Â  Â  Â  Â  Â  formHtml.push(createTextField(`${section.id}-changes`, changesPrompt, "", 2, `${section.path}.recentChanges`));
Â  Â  Â  Â  Â  Â  formHtml.push(createTextField(`${section.id}-goals`, goalsPrompt, "", 2, `${section.path}.futureGoals`));
Â  Â  Â  Â  Â  Â  formHtml.push(`</fieldset>`);
Â  Â  Â  Â  Â  Â  navHtml.push(`<li><a href="#${section.id}">${section.title.split(':')[1].trim()}</a></li>`);
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Add final, non-data sections
Â  Â  Â  Â  formHtml.push(`<h2 id="section-summary">Section 10: Strategic Priorities & Tensions</h2> <p class="section-explanation">This section provides a consolidated view of your changes and goals, and asks you to identify the central strategic challenge.</p> <div id="goals-summary-container"><p>You haven't noted any changes or goals yet. Fill in the fields above to see a summary here.</p></div>`);
Â  Â  Â  Â  formHtml.push(createTextField('strategic-tension', "What is the single biggest tension or conflict between your goals?", "Strategy is about making trade-offs. Identifying your core tension is the most critical step.", 3, "summary.strategicTension", "Example: We want to rapidly innovate new products, but we are also constrained by a tight budget."));
Â  Â  Â  Â  navHtml.push(`<li><a href="#section-summary"><span class="nav-highlight">Priorities</span></a></li>`);
Â  Â  Â  Â Â 
Â  Â  Â  Â  formHtml.push(`<h2 id="section-comments">Section 11: Final Comments</h2> <fieldset>${createTextField("comments-box", "", "Use this field to provide any additional context or explain any 'Uncertain' selections.", 10, "comments.additionalContext")}</fieldset>`);
Â  Â  Â  Â  navHtml.push(`<li><a href="#section-comments"><span class="nav-highlight">Comments</span></a></li>`);
Â  Â  Â  Â Â 
Â  Â  Â  Â  formContainer.innerHTML = formHtml.join('');
Â  Â  Â  Â  navLinksContainer.innerHTML = navHtml.join('');

Â  Â  Â  Â  const buildQuestionnaireHtml = () => {
Â  Â  Â  Â  Â  Â  const questionnaireParts = [
Â  Â  Â  Â  Â  Â  Â  Â  `<h2 id="section-questionnaire">User Input Questionnaire for Strategic Audit</h2>`,
Â  Â  Â  Â  Â  Â  Â  Â  `<p class="section-explanation">To provide a tailored and actionable strategic audit of your organization, please answer the following questions. Your responses will be used to customize the analysis to your role, goals, and needs.</p>`,
Â  Â  Â  Â  Â  Â  Â  Â  `<fieldset>`,
Â  Â  Â  Â  Â  Â  Â  Â  createTextField("audit-goal", "My Strategic Goal", "Describe your primary goal for this audit. Be as specific as possible.", 4, "userContext.strategicGoal", `Examples:
(Fundraising): To prepare a pitch deck for our seed round and pressure-test our strategy for investor scrutiny.
(Decision-Making): To decide whether we should enter the European market or double down on our existing presence in North America.
(Risk & Planning): To identify the top 3 risks to our business in the next 18 months and create a clear mitigation plan.
(Team Alignment): To align our new leadership team around a single, coherent strategy for the next fiscal year.`),
Â  Â  Â  Â  Â  Â  Â  Â  createMultiChoice("relationship", "1. What is your relationship to the organization?", "", "checkbox", [{ label: "Founder/Owner" }, { label: "Executive/Leadership" }, { label: "Manager" }, { label: "Employee/Team Member" }, { label: "Investor/Board Member" }, { label: "Consultant/Advisor" }], "userContext.relationship"),
Â  Â  Â  Â  Â  Â  Â  Â  createMultiChoice("analytical-language", "2. What are the top two 'languages' you use to analyze your business?", "Select your primary and secondary focus.", "checkbox", [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {label: "Financial", description: "I focus on ROI, burn rate, and profitability."},Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {label: "Customer-Centric", description: "I focus on user experience, retention, and satisfaction."},Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {label: "Operational", description: "I focus on efficiency, process, and scalability."},Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {label: "Technical", description: "I focus on product architecture, reliability, and innovation."},Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {label: "Strategic", description: "I focus on market position, competitive advantage, and long-term growth."},Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {label: "Human-Centric", description: "I focus on team culture, talent, and stakeholder alignment."}
Â  Â  Â  Â  Â  Â  Â  Â  ], "userContext.analyticalLanguage"),
Â  Â  Â  Â  Â  Â  Â  Â  `</fieldset>`
Â  Â  Â  Â  Â  Â  ];
Â  Â  Â  Â  Â  Â  const validationStep = `<div class="journey-step"> <h2>Validate Your Organizational Snapshot Assessment with AI Cognitive Partner</h2> <p>The AI will help improve objectivity, clarity, and strategic focus.</p> <div class="ai-validation-container"><button type="button" id="consult-ai-button">AI Cognitive Partner Prompt</button></div></div>`;
Â  Â  Â  Â  Â  Â  return questionnaireParts.join('') + validationStep;
Â  Â  Â  Â  };
Â  Â  Â  Â  finalContainer.innerHTML = buildQuestionnaireHtml();

Â  Â  Â  Â  const handleArchetypeChange = () => {
Â  Â  Â  Â  Â  Â  const selectedArchetype = form.querySelector('input[name="org-archetype"]:checked')?.value;
Â  Â  Â  Â  Â  Â  const conditionalFields = form.querySelectorAll('.conditional-field');

Â  Â  Â  Â  Â  Â  conditionalFields.forEach(field => {
Â  Â  Â  Â  Â  Â  Â  Â  const showFor = field.dataset.showFor ? field.dataset.showFor.split(',') : [];
Â  Â  Â  Â  Â  Â  Â  Â  if (selectedArchetype && showFor.includes(selectedArchetype)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  field.classList.add('visible');
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  field.classList.remove('visible');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  field.querySelectorAll('input, select, textarea').forEach(input => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (input.type === 'radio' || input.type === 'checkbox') input.checked = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  };

Â  Â  Â  Â  const setDirty = (state) => {
Â  Â  Â  Â  Â  Â  if (isDirty === state) return;
Â  Â  Â  Â  Â  Â  isDirty = state;
Â  Â  Â  Â  Â  Â  saveButton.textContent = state ? 'Save Profile to File (.json) *' : 'Save Profile to File (.json)';
Â  Â  Â  Â  Â  Â  saveButton.classList.toggle('is-dirty', state);
Â  Â  Â  Â  };

Â  Â  Â  Â  const showNotification = (message, type = 'success', onClick = null) => {
Â  Â  Â  Â  Â  Â  const banner = document.getElementById('notification-banner');
Â  Â  Â  Â  Â  Â  banner.textContent = message;
Â  Â  Â  Â  Â  Â  banner.className = `is-visible is-${type}`;
Â  Â  Â  Â  Â  Â  banner.onclick = onClick;
Â  Â  Â  Â  Â  Â  const timeout = onClick ? 6000 : 3000;
Â  Â  Â  Â  Â  Â  setTimeout(() => { banner.className = ''; banner.onclick = null; }, timeout);
Â  Â  Â  Â  };

Â  Â  Â  Â  const set = (obj, path, value) => {
Â  Â  Â  Â  Â  Â  const keys = path.split('.');
Â  Â  Â  Â  Â  Â  let current = obj;
Â  Â  Â  Â  Â  Â  for (let i = 0; i < keys.length - 1; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  const key = keys[i];
Â  Â  Â  Â  Â  Â  Â  Â  if (!current[key] || typeof current[key] !== 'object') { current[key] = {}; }
Â  Â  Â  Â  Â  Â  Â  Â  current = current[key];
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  current[keys[keys.length - 1]] = value;
Â  Â  Â  Â  };

Â  Â  Â  Â  const getValueFromPath = (obj, path) => {
Â  Â  Â  Â  Â  Â  return path.split('.').reduce((acc, part) => acc && acc[part], obj);
Â  Â  Â  Â  };

Â  Â  Â  Â  const updateGoalsSummary = () => {
Â  Â  Â  Â  Â  Â  const container = document.getElementById('goals-summary-container');
Â  Â  Â  Â  Â  Â  container.innerHTML = '';
Â  Â  Â  Â  Â  Â  const currentData = gatherFormData();
Â  Â  Â  Â  Â  Â  let contentFound = false;

Â  Â  Â  Â  Â  Â  sections.forEach(section => {
Â  Â  Â  Â  Â  Â  Â  Â  if (section.path) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const changesPath = `${section.path}.recentChanges`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const goalsPath = `${section.path}.futureGoals`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const changesText = getValueFromPath(currentData, changesPath);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const goalsText = getValueFromPath(currentData, goalsPath);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (changesText || goalsText) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  contentFound = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const itemDiv = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  itemDiv.className = 'goals-summary-item';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const strong = document.createElement('strong');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  strong.textContent = section.title;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  itemDiv.appendChild(strong);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (changesText) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const changesLabel = document.createElement('span');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  changesLabel.className = 'summary-label';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  changesLabel.textContent = 'Recent Changes:';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const changesPre = document.createElement('pre');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  changesPre.textContent = changesText;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  itemDiv.appendChild(changesLabel);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  itemDiv.appendChild(changesPre);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (goalsText) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const goalsLabel = document.createElement('span');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  goalsLabel.className = 'summary-label';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  goalsLabel.textContent = 'Future Goals:';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const goalsPre = document.createElement('pre');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  goalsPre.textContent = goalsText;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  itemDiv.appendChild(goalsLabel);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  itemDiv.appendChild(goalsPre);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.appendChild(itemDiv);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  if (!contentFound) {
Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = `<p>You haven't noted any changes or goals yet. Fill in the fields above to see a summary here.</p>`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  const gatherFormData = () => {
Â  Â  Â  Â  Â  Â  const data = { metadata: { version: APP_VERSION, generatedAt: new Date().toISOString() } };
Â  Â  Â  Â  Â  Â  const checkboxPaths = new Set();
Â  Â  Â  Â  Â  Â  form.querySelectorAll('input[type="checkbox"][data-path]').forEach(el => checkboxPaths.add(el.dataset.path));
Â  Â  Â  Â  Â  Â  checkboxPaths.forEach(path => set(data, path, []));
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  form.querySelectorAll('[data-rank-path]').forEach(group => {
Â  Â  Â  Â  Â  Â  Â  Â  const path = group.dataset.rankPath;
Â  Â  Â  Â  Â  Â  Â  Â  const ranks = [];
Â  Â  Â  Â  Â  Â  Â  Â  group.querySelectorAll('input[type="number"]').forEach(input => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (input.value) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ranks.push({ rank: parseInt(input.value, 10), value: input.dataset.rankValue });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  ranks.sort((a, b) => a.rank - b.rank);
Â  Â  Â  Â  Â  Â  Â  Â  set(data, path, ranks.map(item => item.value));
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  form.querySelectorAll('[data-path]').forEach(el => {
Â  Â  Â  Â  Â  Â  Â  Â  const path = el.dataset.path;
Â  Â  Â  Â  Â  Â  Â  Â  if (el.type === 'radio') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (el.checked && el.value) set(data, path, el.value);
Â  Â  Â  Â  Â  Â  Â  Â  } else if (el.tagName.toLowerCase() === 'select') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (el.value) set(data, path, el.value);
Â  Â  Â  Â  Â  Â  Â  Â  } else if (el.type === 'checkbox') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (el.checked) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const currentVal = getValueFromPath(data, path);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!currentVal.includes(el.value)) currentVal.push(el.value);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } else if (el.value) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  set(data, path, el.value);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  return data;
Â  Â  Â  Â  };

Â  Â  Â  Â  const repopulateForm = (data) => {
Â  Â  Â  Â  Â  Â  isRepopulating = true;
Â  Â  Â  Â  Â  Â  form.reset();
Â  Â  Â  Â  Â  Â  const paths = {};
Â  Â  Â  Â  Â  Â  const recurse = (obj, prefix = '') => {
Â  Â  Â  Â  Â  Â  Â  Â  if (!obj || typeof obj !== 'object') return;
Â  Â  Â  Â  Â  Â  Â  Â  Object.keys(obj).forEach(key => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const value = obj[key];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const newPrefix = prefix ? `${prefix}.${key}` : key;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (value && typeof value === 'object' && !Array.isArray(value)) { recurse(value, newPrefix); } else { paths[newPrefix] = value; }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  recurse(data);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Object.keys(paths).forEach(path => {
Â  Â  Â  Â  Â  Â  Â  Â  const value = paths[path];
Â  Â  Â  Â  Â  Â  Â  Â  const elements = form.querySelectorAll(`[data-path="${path}"]`);
Â  Â  Â  Â  Â  Â  Â  Â  elements.forEach(el => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  switch (el.type) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 'radio': if (el.value === value) el.checked = true; break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 'checkbox':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (Array.isArray(value) && value.includes(el.value)) el.checked = true; else el.checked = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  default: el.value = value || ''; break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  form.querySelectorAll('[data-rank-path]').forEach(group => {
Â  Â  Â  Â  Â  Â  Â  Â  const path = group.dataset.rankPath;
Â  Â  Â  Â  Â  Â  Â  Â  const rankedValues = getValueFromPath(data, path);
Â  Â  Â  Â  Â  Â  Â  Â  if (Array.isArray(rankedValues)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  group.querySelectorAll('input[type="number"]').forEach(input => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const rankIndex = rankedValues.indexOf(input.dataset.rankValue);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (rankIndex !== -1) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  input.value = rankIndex + 1;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  handleArchetypeChange();
Â  Â  Â  Â  Â  Â  updateGoalsSummary();
Â  Â  Â  Â  Â  Â  isRepopulating = false;
Â  Â  Â  Â  Â  Â  setDirty(false);
Â  Â  Â  Â  };

Â  Â  Â  Â  const saveStateToLocalStorage = () => { if (isDirty) localStorage.setItem('convoking4_autosave', JSON.stringify(gatherFormData())); };

Â  Â  Â  Â  const loadStateFromLocalStorage = () => {
Â  Â  Â  Â  Â  Â  const savedData = localStorage.getItem('convoking4_autosave');
Â  Â  Â  Â  Â  Â  if (savedData) {
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const data = JSON.parse(savedData);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  repopulateForm(data);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const clearStorage = () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  localStorage.removeItem('convoking4_autosave');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showNotification('Cleared restored progress.', 'success');
Â  Â  Â  Â  Â  Â  Â  _B_
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showNotification('Unsaved progress from a previous session has been restored. Click here to clear.', 'info', clearStorage);
Â  Â  Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Could not parse autosaved data.", e);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  localStorage.removeItem('convoking4_autosave');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  const saveProfileToFile = () => {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const data = gatherFormData();
Â  Â  Â  Â  Â  Â  Â  Â  if (!data.basicIdentifiers || !data.basicIdentifiers.organizationName) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showNotification('Please enter an Organization Name first.', 'error');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('org-name').focus();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  const orgName = data.basicIdentifiers.organizationName.replace(/[^a-z0-9]/gi, '_').toLowerCase();
Â  Â  Â  Â  Â  Â  Â  Â  const fileName = `${orgName}_snapshot_${new Date().toISOString().split('T')[0]}.json`;
Â  Â  Â  Â  Â  Â  Â  Â  const fileContent = JSON.stringify(data, null, 2);
Â  Â  Â  Â  Â  Â  Â  Â  const blob = new Blob([fileContent], { type: 'application/json' });
Â  Â  Â  Â  Â  Â  Â  Â  const a = document.createElement('a');
Â  Â  Â  Â  Â  Â  Â  Â  a.href = URL.createObjectURL(blob);
Â  Â  Â  Â  Â  Â  Â  Â  a.download = fileName;
Â  Â  Â  Â  Â  Â  Â  Â  document.body.appendChild(a);
Â  Â  Â  Â  Â  Â  Â  Â  a.click();
Â  Â  Â  Â  Â  Â  Â  Â  document.body.removeChild(a);
Â  Â  Â  Â  Â  Â  Â  Â  URL.revokeObjectURL(a.href);
Â  Â  Â  Â  Â  Â  Â  Â  setDirty(false);
Â  Â  Â  Â  Â  Â  Â  Â  showNotification('Profile saved successfully!', 'success');
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error saving profile:', error);
Â  Â  Â  Â  Â  Â  Â  Â  showNotification('Could not save the profile.', 'error');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  const loadProfileFromFile = (event) => {
Â  Â  Â  Â  Â  Â  const file = event.target.files[0];
Â  Â  Â  Â  Â  Â  if (!file) return;
Â  Â  Â  Â  Â  Â  const reader = new FileReader();
Â  Â  Â  Â  Â  Â  reader.onload = function (e) {
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const data = JSON.parse(e.target.result);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!data.metadata || !data.basicIdentifiers) { throw new Error("Invalid or incomplete profile structure."); }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  form.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  repopulateForm(data);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showNotification(`Profile "${data.basicIdentifiers.organizationName}" loaded.`, 'success');
Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error parsing JSON file:', error);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showNotification('Invalid or corrupted profile file.', 'error');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  reader.readAsText(file);
Â  Â  Â  Â  Â  Â  event.target.value = null;
Â  Â  Â  Â  };

Â  Â  Â  Â  // --- AI Prompt Modal Logic ---
Â  Â  Â  Â  const consultAiButton = document.querySelector('#consult-ai-button');
Â  Â  Â  Â  const aiPromptModal = document.getElementById('ai-prompt-modal');
Â  Â  Â  Â  const aiPromptOutput = document.getElementById('ai-prompt-output');
Â  Â  Â  Â  const selectPromptButton = document.getElementById('select-prompt-button');
Â  Â  Â  Â  const closeModalButtons = document.querySelectorAll('#close-modal-button-top, #close-modal-button-bottom');
Â  Â  Â  Â Â 
Â  Â  Â  Â  const generateAIPrompt = () => {
Â  Â  Â  Â  Â  Â  const allData = gatherFormData();
Â  Â  Â  Â  Â  Â  const orgData = { ...allData };
Â  Â  Â  Â  Â  Â  delete orgData.userContext;
Â  Â  Â  Â  Â  Â  const userContext = allData.userContext || {};
Â  Â  Â  Â  Â  Â  const relationship = userContext.relationship ? userContext.relationship.join(', ') : '';
Â  Â  Â  Â  Â  Â  const infoFormat = userContext.informationFormat ? userContext.informationFormat.join(', ') : '';
Â  Â  Â  Â  Â  Â  const analyticalLanguage = userContext.analyticalLanguage ? userContext.analyticalLanguage.join(', ') : '';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const fieldMapping = {};
Â  Â  Â  Â  Â  Â  form.querySelectorAll('[data-path]').forEach(el => {
Â  Â  Â  Â  Â  Â  Â  Â  const path = el.dataset.path;
Â  Â  Â  Â  Â  Â  Â  Â  const formGroup = el.closest('.form-group');
Â  Â  Â  Â  Â  Â  Â  Â  if (formGroup) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const label = formGroup.querySelector('.main-label, .subsection-title');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (label && !fieldMapping[path]) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â fieldMapping[path] = label.textContent;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  const promptTemplate = `
[1.0 PERSONA & PRIME DIRECTIVE]
You are an AI Organizational Strategist, functioning as a fractional Chief Strategy Officer. Your analysis must adapt to the organizationâ€™s sector and type, ensuring relevance to its unique context. Your prime directive is to provide a comprehensive, actionable, and unbiased strategic advisory that is explicitly aligned with the userâ€™s stated strategic objective and the organizationâ€™s mission, vision, and values.

[1.1 BIAS & BLIND SPOT ANALYSIS]
A critical part of your analysis is to identify the user's potential blind spots. The user has selected their primary analytical 'languages' (e.g., "Financial", "Customer-Centric"). You MUST analyze their strategy from the perspectives of the languages they **did not** select. For example, if they selected 'Customer-Centric' and 'Strategic', you should deliberately stress-test their plan from a 'Financial' and 'Operational' lens in your 'Bias and Misalignment Check' sections, looking for what they might have missed.

[1.5 STRATEGIC OBJECTIVE / THE 'WHY']
My Goal: "${userContext.strategicGoal || "Not specified. Assume the goal is to identify the highest-impact strategic priorities for the next 12-18 months."}"

[2.0 DATA STREAM & CONTEXT]

[2.1 ORGANIZATIONAL PROFILE JSON]
<details> <summary>View Organizational Profile JSON</summary>
\`\`\`json
${JSON.stringify(orgData, null, 2)}
\`\`\`
</details>

[2.5 USER CONTEXT PROFILE (FROM QUESTIONNAIRE)]
My Relationship to the Organization: "${relationship || 'Not specified.'}"
My Top Two Analytical 'Languages': "${analyticalLanguage || "Not specified."}"

[3.0 CORE DIRECTIVES: ANALYSIS & MODELING]
(Instructions from previous prompt are assumed here for brevity)

[4.0 OUTPUT PROTOCOL]
(Instructions from previous prompt are assumed here for brevity)
`;
Â  Â  Â  Â  Â  Â  return promptTemplate.trim();
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  consultAiButton.addEventListener('click', () => { aiPromptOutput.value = generateAIPrompt(); aiPromptModal.showModal(); });
Â  Â  Â  Â  closeModalButtons.forEach(button => button.addEventListener('click', () => aiPromptModal.close()));
Â  Â  Â  Â Â 
Â  Â  Â  Â  selectPromptButton.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  aiPromptOutput.select();
Â  Â  Â  Â  Â  Â  aiPromptOutput.setSelectionRange(0, aiPromptOutput.value.length);
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  navigator.clipboard.writeText(aiPromptOutput.value);
Â  Â  Â  Â  Â  Â  Â  Â  showNotification('Prompt copied to clipboard!', 'success');
Â  Â  Â  Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('Clipboard API failed:', err);
Â  Â  Â  Â  Â  Â  Â  Â  showNotification('Could not copy text.', 'error');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  function updateScrollMargin() {
Â  Â  Â  Â  Â  Â  const headerHeight = topBar.getBoundingClientRect().height;
Â  Â  Â  Â  Â  Â  const marginValue = Math.ceil(headerHeight) + 20;

Â  Â  Â  Â  Â  Â  if (!scrollMarginStyleElement) {
Â  Â  Â  Â  Â  Â  Â  Â  scrollMarginStyleElement = document.createElement('style');
Â  Â  Â  Â  Â  Â  Â  Â  document.head.appendChild(scrollMarginStyleElement);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  scrollMarginStyleElement.textContent = `h2[id] { scroll-margin-top: ${marginValue}px; }`;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function debounce(func, delay = 100) {
Â  Â  Â  Â  Â  Â  let timeout;
Â  Â  Â  Â  Â  Â  return function(...args) {
Â  Â  Â  Â  Â  Â  Â  Â  clearTimeout(timeout);
Â  Â  Â  Â  Â  Â  Â  Â  timeout = setTimeout(() => func.apply(this, args), delay);
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- Initial Setup and Event Listeners ---
Â  Â  Â  Â  document.getElementById('version-display').textContent = `Version ${APP_VERSION}`;
Â  Â  Â  Â  document.getElementById('current-date').textContent = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
Â  Â  Â  Â  saveButton.addEventListener('click', saveProfileToFile);
Â  Â  Â  Â  document.getElementById('progress-file-loader').addEventListener('change', loadProfileFromFile);
Â  Â  Â  Â Â 
Â  Â  Â  Â  form.addEventListener('submit', (event) => event.preventDefault());
Â  Â  Â  Â  form.addEventListener('input', (e) => {
Â  Â  Â  Â  Â  Â  if (isRepopulating) return;
Â  Â  Â  Â  Â  Â  setDirty(true);
Â  Â  Â  Â  Â  Â  clearTimeout(window.saveTimeout);
Â  Â  Â  Â  Â  Â  window.saveTimeout = setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  saveStateToLocalStorage();
Â  Â  Â  Â  Â  Â  Â  Â  updateGoalsSummary();
Â  Â  Â  Â  Â  Â  }, 500);
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  form.addEventListener('change', (e) => {
Â  Â  Â  Â  Â  Â  if (e.target.name === 'org-archetype') {
Â  Â  Â  Â  Â  Â  Â  Â  handleArchetypeChange();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (e.target.name === 'analytical-language') {
Â  Â  Â  Â  Â  Â  Â  Â  const checkboxes = form.querySelectorAll('input[name="analytical-language"]:checked');
Â  Â  Â  Â  Â  Â  Â  Â  if (checkboxes.length > 2) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.target.checked = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showNotification("Please select a maximum of two languages.", "error");
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  // --- Final Initialization ---
Â  Â  Â  Â  loadStateFromLocalStorage();
Â  Â  Â  Â  updateGoalsSummary();
Â  Â  Â  Â Â 
Â  Â  Â  Â  window.addEventListener('load', updateScrollMargin);
Â  Â  Â  Â  window.addEventListener('resize', debounce(updateScrollMargin));

Â  Â  })();
Â  Â  </script>
</body>
</html>
